# Blue-Green Deployment Upstream 설정
# ACTIVE_ENVIRONMENT 환경 변수로 트래픽 라우팅 제어

# ========================================
# Spring Boot Backend Upstreams
# ========================================
upstream spring-boot-blue {
    server spring-boot-blue:8080 max_fails=3 fail_timeout=30s;
}

upstream spring-boot-green {
    server spring-boot-green:8080 max_fails=3 fail_timeout=30s;
}

# ========================================
# FastAPI Backend Upstreams
# ========================================
upstream fastapi-blue {
    server fastapi-blue:8000 max_fails=3 fail_timeout=30s;
}

upstream fastapi-green {
    server fastapi-green:8000 max_fails=3 fail_timeout=30s;
}

# ========================================
# React Frontend Upstreams
# ========================================
upstream react-blue {
    server react-blue:80 max_fails=3 fail_timeout=30s;
}

upstream react-green {
    server react-green:80 max_fails=3 fail_timeout=30s;
}

# ========================================
# Jenkins Upstream
# ========================================
upstream jenkins {
    server jenkins:8080;
}

# ========================================
# Monitoring Upstreams
# ========================================
upstream prometheus {
    server prometheus:9090;
}

upstream grafana {
    server grafana:3000;
}
